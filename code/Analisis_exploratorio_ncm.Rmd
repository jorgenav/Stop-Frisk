---
title: "Untitled"
author: "Nahaly_Cardenas"
date: "16 de marzo de 2017"
output: html_document
---
## Problemática



## Hipóteis inicial
Se plantea como hipótesis la  demanda publicada en New York Liberty Civils <https://www.nyclu.org/en/stop-and-frisk-data> , es decir verificar si la ley Stop-Frisk está siendo aplicada bajo conceptos de discriminación.  El análisis inicial se fundamentó en el tiempo de observación, sin embargo se desechó la posibilidad, dado que no se tiene registro de personas observadas que no fueron paradas.


## Pregunta 1
Cuáles son los factores que determinan el tiempo de parada `perstop`, interesa verificar si está influenciado por características discriminatorias.

```{r, message=FALSE}
# Carga de librerías
library(dplyr)
library(ggplot2)
library(PASWR2)
library("dataQualityR")
library(mixtools)
library(fitdistrplus)
```

```{r}
# Carga del Dataset
#SQFdata <- read.csv("2014.csv")
# buscar attach???? o similar
if(!exists("foo", mode="function")) source("Cleaning_Data.R")
```

# 0. SELECCION DE VARIABLES (para este informe):
```{r}
SQFdata <- dplyr::select(SQFdata,
                  perstop,
                  perobs,
                  arstmade,
                  pct,
                  ser_num,
                  city,
                  searched,
                  pistol,
                  pf_hcuff,
                  pf_pepsp,
                  cs_drgtr,
                  cs_furtv,
                  cs_vcrim,
                  rf_rfcmp,
                  rf_verbl,
                  sb_other,
                  ac_proxm,
                  ac_rept,
                  inout,
                  trhsloc,
                  addrpct,
                  repcmd,
                  revcmd
                  )
```

```{r}
str(SQFdata)
```

# 1. DATA QUALITY REPORT
```{r}
drq.num <- paste("./dqr_num.csv", sep = "")
drq.cat <- paste("./dqr_cat.csv", sep = "")
checkDataQuality(SQFdata, out.file.num = drq.num,  out.file.cat = drq.cat)
DQR.num <- read.csv("dqr_num.csv")
DQR.cat <- read.csv("dqr_cat.csv")
```

## 1.A Variables numéricas
```{r, results=markup}
print(DQR.num)
```

## 1.B Variables categóricas
```{r}
print(DQR.cat)
```

# 2. ANÁLISIS EXPLORATORIO VARIABLES

## VARIABLE DEPENDIENTE
## Tiempo de parada (perstop)
```{r, fig.height=5, fig.width=15}
#hist(SQFdata$perstop, breaks = 20,  prob=F, xlim=c(0,87))
plotdist(SQFdata$perstop , histo = TRUE, demp = TRUE)

stop <- SQFdata$perstop
mixmdl <- normalmixEM(stop, k=2)
plot(mixmdl,which=2)
lines(density(stop), lty=2, lwd=2)
```
## VARIABLES INDEPENDIENTES

## Tiempo de observación (perobs)
```{r, fig.height=5, fig.width=15}
SQFdata %>% filter(perobs<150) %>%
        ggplot(aes(perobs, perstop)) +
        geom_point() +
        labs(x="Período de observación ", y="Período de parada") +
        geom_smooth(method = 'lm') +
        scale_size_area() +
        ggtitle("Relación entre tiempo de observación y parada")
```

```{r, fig.height=5, fig.width=15}
cor(obs, stop)
```

```{r, fig.height=5, fig.width=15}
SQFdata %>% 
        group_by(arstmade) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2),
                  perObs= sum(perobs),
                  perObs_media= round(mean(perobs),2),
                  perObs_mediana= round(median(perobs),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```


```{r, fig.height=5, fig.width=15}
SQFdata %>% filter(perobs<150)%>% 
        ggplot(aes(arstmade, log(perobs))) +
        geom_boxplot()
        ggtitle("Relación entre tiempo de observación y parada")
```

## Condados (city)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, city) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(city)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(city,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(city)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```
## Buscado (searched)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, searched) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(searched)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(searched,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(searched)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Pistola (pistol)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, pistol) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(pistol)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(pistol,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(pistol)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```
## El oficial usa fuerza físcica - esposas (pf_hcuff)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, pf_hcuff) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(pf_hcuff)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(pf_hcuff,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(pf_hcuff)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```
## El oficial usa fuerza física - spray pimienta (pf_pepsp)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, pf_pepsp) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(pf_pepsp)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(pf_pepsp,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(pf_pepsp)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```
## Razón para la parada - acciones indicaban transacción de drogas (cs_drgtr)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, cs_drgtr) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(cs_drgtr)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(cs_drgtr,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(cs_drgtr)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Razón para la parada - movimientos sospechosos (cs_furtv)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, cs_furtv) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(cs_furtv)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(cs_furtv,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(cs_furtv)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Razón para la parada - acciones que indican estar involucrado en un crimen violento (cs_vcrim)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, cs_vcrim) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(cs_vcrim)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(cs_vcrim,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(cs_vcrim)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Razón para la parada - rehusarse a cumplir con las instrucciones del oficial (rf_rfcmp)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, rf_rfcmp) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(rf_rfcmp)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(rf_rfcmp,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(rf_rfcmp)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Razón para la parada - amenazas verbales por parte del sospechoso (rf_verbl)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, rf_verbl) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(rf_verbl)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(rf_verbl,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(rf_verbl)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Razón de busqueda - otros (sb_other)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, sb_other) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(sb_other)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(sb_other,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(sb_other)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Circunstancias adicionales - proximidad a la escena del delito (ac_proxm)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, ac_proxm) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(ac_proxm)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(ac_proxm,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(ac_proxm)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Circunstancias adicionales - informe de la víctima / testigo / oficial (ac_rept)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, ac_rept) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(ac_rept)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(ac_rept,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(ac_rept)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Fue parado dentro o fuera (inout)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, inout) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(inout)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(inout,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(inout)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Fue ubicado en la vivienda o por la autoridad  (trhsloc)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, trhsloc) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(trhsloc)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(trhsloc,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(trhsloc)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Recinto donde se realizó la parada (pct)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, pct) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(pct)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(pct,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(pct)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Dirección del recinto donde se realizó la parada (addrpct)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, addrpct) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(addrpct)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(addrpct,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(addrpct)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Comando del oficial que hace el informe  (repcmd)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, repcmd) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(repcmd)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(repcmd,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(repcmd)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

## Comando del oficial que revisa  (revcmd)
```{r, fig.height=5, fig.width=15}
SQFdata %>% group_by(arstmade, revcmd) %>%
        summarise(n=n(), 
                  perStop= sum(perstop),
                  perStop_media= round(mean(perstop),2),
                  perStop_mediana= round(median(perstop),2)) %>%
        mutate(freq_n=paste0(round( n/sum(n)*100,2),"%"))

```

```{r, fig.height=5, fig.width=15}
p1 = ggplot(data = SQFdata, aes(revcmd)) + geom_bar() + ylab("Frecuencia")
p2 = ggplot(data = SQFdata, aes(revcmd,perstop)) + geom_boxplot()
p3 = ggplot(data = SQFdata, aes(revcmd)) + geom_bar(aes(fill = arstmade), position = "fill") + ylab("Porcentaje")
multiplot(p1,p2,p3,cols=2)
```

# Análisis variables independientes







